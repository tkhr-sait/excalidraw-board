# excalidraw-board 開発計画

## 1. プロジェクト概要

excalidraw-boardは、Excalidrawライブラリを利用したセルフホスティング可能なリアルタイムコラボレーションホワイトボードアプリケーションです。

### 主要要件
- ローカルネットワーク内でのセルフホスティング
- リアルタイムコラボレーション機能
- 外部サービス（ドメイン名、証明書）への依存なし
- excalidraw公式リポジトリの実装方式を踏襲

## 2. 技術スタック

### フロントエンド
- React + TypeScript
- Excalidrawライブラリ
- Socket.IO Client（リアルタイム通信）
- Vite（ビルドツール）

### バックエンド
- excalidraw-room（Docker Hub公式イメージ、無改造）
- WebSocket Server（Socket.IO）

### テスト
- Vitest（ユニットテスト）
- Playwright（E2Eテスト、ヘッドレスモード）

### 開発環境
- Docker / Docker Compose
- Node.js 18+
- pnpm（パッケージマネージャー）

## 3. アーキテクチャ設計

### システム構成
```
┌─────────────────┐     ┌──────────────────┐
│   クライアント    │     │   クライアント     │
│  (React App)    │     │  (React App)     │
└────────┬────────┘     └────────┬─────────┘
         │                       │
         └───────────┬───────────┘
                     │ WebSocket
                     │
         ┌───────────┴────────────┐
         │   excalidraw-room      │
         │  (Dockerコンテナ)       │
         └────────────────────────┘
```

### ディレクトリ構造
```
excalidraw-board/
├── frontend/               # フロントエンドアプリケーション
│   ├── src/
│   │   ├── App.tsx        # メインアプリケーション（excalidraw-app/App.tsx踏襲）
│   │   ├── collab/        # コラボレーション機能
│   │   │   └── Collab.tsx # コラボレーション実装（excalidraw-app/collab/Collab.tsx踏襲）
│   │   └── ...
│   └── tests/             # テストコード
├── docker/                # Docker関連設定
│   └── docker-compose.yml
├── docs/                  # ドキュメント
│   ├── plan.md           # 本計画書
│   ├── adr/              # Architecture Decision Records
│   └── tasks/            # タスク詳細
└── samples/              # 技術検証用サンプル実装
```

## 4. 開発プロセス

### 基本方針
1. **テストファースト開発**: 実装前にテストコードを作成
2. **段階的実装**: 小さな単位で実装・検証を繰り返す
3. **技術検証**: 不明点は簡易サンプルで動作確認
4. **ADR管理**: 重要な技術的決定を記録

### 開発フロー
1. タスクごとにテストコード作成
2. 最小限の実装で動作確認
3. リファクタリング
4. ドキュメント更新

## 5. タスク概要

### フェーズ1: 基盤構築
- **task-01**: プロジェクト初期設定とビルド環境構築
- **task-02**: Docker環境のセットアップ
- **task-03**: 基本的なExcalidrawコンポーネントの統合

### フェーズ2: コラボレーション機能実装
- **task-04**: Socket.IOクライアントの実装
- **task-05**: コラボレーションコンポーネントの実装
- **task-06**: リアルタイム同期機能の実装

### フェーズ3: テストと品質保証
- **task-07**: ユニットテストの実装
- **task-08**: E2Eテストの実装（Playwright）
- **task-09**: パフォーマンステストと最適化

### フェーズ4: デプロイメント準備
- **task-10**: 本番環境用設定
- **task-11**: デプロイメントドキュメント作成
- **task-12**: 最終動作確認とリリース準備

## 6. 成果物

### 最終成果物
1. **動作するアプリケーション**
   - フロントエンド（Reactアプリ）
   - バックエンド（excalidraw-roomコンテナ）

2. **ドキュメント**
   - インストールガイド
   - 設定ガイド
   - Architecture Decision Records

3. **テストスイート**
   - ユニットテスト
   - E2Eテスト

4. **デプロイメント資材**
   - Docker Compose設定
   - 環境変数設定例

## 7. スケジュール目安

- フェーズ1: 2日
- フェーズ2: 3日
- フェーズ3: 2日
- フェーズ4: 1日

合計: 約8日

## 8. リスクと対策

### 技術的リスク
1. **excalidraw-roomの仕様不明**
   - 対策: 早期に動作検証環境を構築

2. **ローカルネットワークでのWebSocket通信**
   - 対策: HTTPでの動作確認を優先

3. **Excalidrawライブラリのバージョン互換性**
   - 対策: 公式リポジトリと同じバージョンを使用

### 運用リスク
1. **パフォーマンス問題**
   - 対策: 同時接続数の制限設定

2. **データ永続化**
   - 対策: 初期版では永続化なし（将来的に検討）